[pytest]
# Pytest configuration for TranscriptX
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Markers for test categorization
markers =
    smoke: fast, deterministic, no external services/models; required for CI
    unit: Unit tests for individual functions/classes
    integration: Integration tests for workflows and pipelines
    contract: Offline contract tests (output shape, no external deps)
    slow: Tests that take longer to run (ML models, file I/O)
    requires_models: Tests that require downloaded ML models
    requires_docker: Tests that require a Docker daemon or containers
    requires_ffmpeg: Tests that require ffmpeg/ffprobe on PATH
    requires_api: Tests that require external API access
    integration_core: Stable integration subset for nightly runs
    integration_extended: Extended integration suite (nightly or manual)
    database: Tests that require database setup
    performance: Performance and benchmark tests
    quarantined: Temporarily quarantined tests (must include reason and sunset)
    timeout: Tests that may legitimately take longer than 5 minutes

# Avoid collecting backups/duplicates that shadow real modules (ImportPathMismatchError).
# Exclude tests/archived (e.g. test_convokit.py) which reference removed/archived code.
norecursedirs =
    transcriptx*backup
    archived

# Output options (exclude quarantined by default for green CI; run full suite with: pytest -m "")
addopts = 
    -ra
    --strict-markers
    --strict-config
    --import-mode=importlib
    --verbose
    --tb=short
    --timeout=300
    --timeout-method=thread
    -m "not quarantined"

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:transformers.*
    ignore::UserWarning:torch.*
    ignore::UserWarning:sklearn.*
    ignore:\[W095\].*:UserWarning:spacy.*

# Minimum version
minversion = 7.0
